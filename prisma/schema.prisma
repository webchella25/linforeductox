// prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// USUARIOS (Admin - solo Aline)
model User {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String
  name      String
  role      String   @default("admin")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// SERVICIOS
model Service {
  id          String    @id @default(cuid())
  name        String
  slug        String    @unique
  description String    @db.Text
  duration    Int       // Duración en minutos
  price       Float?
  category    String    // "corporal", "facial", "acupuntura"
  benefits    String[]  // Array de beneficios
  conditions  String[]  // Array de condiciones que trata
  active      Boolean   @default(true)
  order       Int       @default(0)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  
  bookings    Booking[]
}

// HORARIOS DE TRABAJO
model WorkingHours {
  id           String   @id @default(cuid())
  dayOfWeek    Int      // 0=Domingo, 1=Lunes, ..., 6=Sábado
  isOpen       Boolean  @default(true)
  openTime     String?  // "09:00"
  closeTime    String?  // "20:00"
  breakStart   String?  // "14:00"
  breakEnd     String?  // "15:00"
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  
  @@unique([dayOfWeek])
}

// CONFIGURACIÓN GENERAL
model Settings {
  id                String   @id @default(cuid())
  key               String   @unique
  value             String   @db.Text
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
}

// FECHAS BLOQUEADAS
model BlockedDate {
  id        String   @id @default(cuid())
  date      DateTime
  reason    String?
  allDay    Boolean  @default(true)
  startTime String?
  endTime   String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// RESERVAS
model Booking {
  id            String   @id @default(cuid())
  
  // Información del servicio
  serviceId     String
  service       Service  @relation(fields: [serviceId], references: [id])
  
  // Fecha y hora
  date          DateTime
  startTime     String   // "10:00"
  endTime       String   // "11:30"
  
  // Información del cliente
  clientName    String
  clientEmail   String
  clientPhone   String
  clientNotes   String?  @db.Text
  
  // Estado de la reserva
  status        BookingStatus @default(PENDING)
  
  // Notas internas de Aline
  adminNotes    String?  @db.Text
  
  // Cancelación
  cancelledAt   DateTime?
  cancelReason  String?
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  @@index([date, status])
  @@index([clientEmail])
}

enum BookingStatus {
  PENDING      // Pendiente de confirmación
  CONFIRMED    // Confirmada por Aline
  CANCELLED    // Cancelada
  COMPLETED    // Completada
  NO_SHOW      // Cliente no se presentó
}

// TESTIMONIOS
model Testimonial {
  id          String   @id @default(cuid())
  name        String
  email       String?
  service     String?
  rating      Int      // 1-5 estrellas
  text        String   @db.Text
  image       String?
  status      TestimonialStatus @default(PENDING)
  order       Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@index([status])
}

enum TestimonialStatus {
  PENDING    // Pendiente de aprobación
  APPROVED   // Aprobado y visible
  REJECTED   // Rechazado
}

// CONTENIDO DE LA WEB
model Content {
  id        String   @id @default(cuid())
  section   String   @unique // "home_hero", "about_bio", etc.
  title     String?
  subtitle  String?
  content   String   @db.Text
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// INFORMACIÓN DE CONTACTO
model ContactInfo {
  id        String   @id @default(cuid())
  phone     String?
  email     String?
  whatsapp  String?
  address   String?
  city      String?
  zipCode   String?
  bufferMinutes Int?    // ← añade esta línea si lo usas
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}