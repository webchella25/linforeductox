// prisma/schema.prisma

generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["driverAdapters"]
}

datasource db {
  provider = "postgresql"
  url      = env("ACCELERATE_URL")
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String
  name      String
  role      String   @default("admin")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Category {
  id          String    @id @default(cuid())
  name        String    @unique
  slug        String    @unique
  description String?
  color       String    @default("#2C5F2D")
  icon        String    @default("üíÜ‚Äç‚ôÄÔ∏è")
  gradient    String    @default("from-primary/90 via-primary/70 to-primary-dark/90")
  imageUrl    String?
  active      Boolean   @default(true)
  order       Int       @default(0)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  
  services    Service[] @relation("ServiceCategory")  // ‚úÖ Agregar nombre de relaci√≥n
  
  @@map("categories")
}

model Service {
  id          String    @id @default(cuid())
  name        String
  slug        String    @unique
  description String
  duration    Int
  price       Float?
  
  // ‚úÖ MANTENER columna vieja Y agregar nueva
  category    String    // ‚Üê Columna vieja (temporal)
  categoryId  String?   // ‚Üê Columna nueva (opcional por ahora)
  categoryRel Category? @relation("ServiceCategory", fields: [categoryId], references: [id])  // ‚úÖ Mismo nombre
  
  benefits    String[]
  conditions  String[]
  active      Boolean   @default(true)
  order       Int       @default(0)
  
  heroImage   String?
  images      Json?
  
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  
  bookings    Booking[]
  faqs        FAQ[]
  subTreatments  SubTreatment[]  // ‚úÖ NUEVA RELACI√ìN
  
  @@index([categoryId])
}

// ‚úÖ NUEVO MODELO
model SubTreatment {
  id          String   @id @default(cuid())
  serviceId   String
  service     Service  @relation(fields: [serviceId], references: [id], onDelete: Cascade)
  
  name        String
  description String   @db.Text
  duration    Int?     // Duraci√≥n espec√≠fica (opcional, en minutos)
  imageUrl    String?  // Imagen del subtratamiento (opcional)
  
  active      Boolean  @default(true)
  order       Int      @default(0)
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@index([serviceId])
  @@map("sub_treatments")
}

model WorkingHours {
  id         String   @id @default(cuid())
  dayOfWeek  Int      @unique
  isOpen     Boolean  @default(true)
  openTime   String?
  closeTime  String?
  breakStart String?
  breakEnd   String?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
}

model Settings {
  id        String   @id @default(cuid())
  key       String   @unique
  value     String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model BlockedDate {
  id        String   @id @default(cuid())
  date      DateTime
  reason    String?
  allDay    Boolean  @default(true)
  startTime String?
  endTime   String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Booking {
  id           String        @id @default(cuid())
  serviceId    String
  date         DateTime
  startTime    String
  endTime      String
  clientName   String
  clientEmail  String
  clientPhone  String
  clientNotes  String?
  status       BookingStatus @default(PENDING)
  adminNotes   String?
  cancelledAt  DateTime?
  cancelReason String?
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  
  service      Service       @relation(fields: [serviceId], references: [id])
  
  @@index([date, status])
  @@index([clientEmail])
}

model Testimonial {
  id        String            @id @default(cuid())
  name      String
  email     String?
  service   String?
  rating    Int
  text      String
  image     String?
  status    TestimonialStatus @default(PENDING)
  order     Int               @default(0)
  createdAt DateTime          @default(now())
  updatedAt DateTime          @updatedAt
  
  @@index([status])
}

model Content {
  id        String   @id @default(cuid())
  section   String   @unique
  title     String?
  subtitle  String?
  content   String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model ContactInfo {
  id            String   @id @default(cuid())
  phone         String?
  email         String?
  whatsapp      String?
  address       String?
  city          String?
  zipCode       String?
  bufferMinutes Int?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model FAQ {
  id         String   @id @default(cuid())
  serviceId  String
  service    Service  @relation(fields: [serviceId], references: [id], onDelete: Cascade)
  question   String
  answer     String
  order      Int      @default(0)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  
  @@index([serviceId])
}

model LegalPage {
  id        String   @id @default(cuid())
  slug      String   @unique
  title     String
  content   String   @db.Text
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@map("legal_pages")
}

model SiteConfig {
  id              String   @id @default(cuid())
  
  // Colores
  primaryColor    String   @default("#2C5F2D")
  primaryDark     String   @default("#1e3d1f")
  secondaryColor  String   @default("#A27B5C")
  secondaryLight  String   @default("#b89171")
  creamColor      String   @default("#F5F1E8")
  textColor       String   @default("#1F2937")
  
  // Fuentes (opcional futuro)
  headingFont     String   @default("Playfair Display")
  bodyFont        String   @default("Inter")
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  @@map("site_config")
}

model Event {
  id              String      @id @default(cuid())
  title           String
  slug            String      @unique
  shortDescription String     @db.Text // Para listado
  description     String      @db.Text // Descripci√≥n completa (Markdown/HTML)
  
  // Fechas
  startDate       DateTime
  endDate         DateTime?
  
  // Ubicaci√≥n
  location        String      // "Centro", "Online", "Otra ubicaci√≥n"
  locationDetails String?     // Direcci√≥n completa si es externa
  
  // Clasificaci√≥n
  eventType       String      // "Taller", "Charla", "Retiro", "Evento Especial", "Colaboraci√≥n"
  
  // Precio
  price           Float?
  isFree          Boolean     @default(false)
  
  // Plazas
  maxPlaces       Int?
  availablePlaces Int?
  
  // Im√°genes
  heroImage       String?     // Imagen principal
  images          Json?       // Galer√≠a de im√°genes adicionales
  // Formato: [{ url: "...", alt: "...", publicId: "..." }]
  
  // Video
  videoUrl        String?     // YouTube/Vimeo URL
  
  // Contenido adicional
  includes        String[]    @default([]) // ¬øQu√© incluye?
  whatToBring     String[]    @default([]) // ¬øQu√© llevar?
  requirements    String?     @db.Text // Requisitos
  
  // Inscripci√≥n
  whatsappNumber  String?     // N√∫mero de WhatsApp para inscripci√≥n
  whatsappMessage String?     @db.Text // Mensaje pre-rellenado
  
  // Estado
  status          EventStatus @default(UPCOMING)
  active          Boolean     @default(true)
  
  // Orden
  order           Int         @default(0)
  
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt
  
  @@index([startDate])
  @@index([status])
  @@map("events")
}

// Configuraci√≥n del Hero de la Portada
model HeroConfig {
  id              String   @id @default(cuid())
  
  // Imagen de fondo
  backgroundImage String?
  
  // Textos
  greeting        String   @default("Bienvenid@")
  mainTitle       String   @default("LINFOREDUCTOX")
  description     String   @db.Text
  
  // Botones
  primaryButtonText   String @default("Ver Servicios")
  primaryButtonLink   String @default("/servicios")
  secondaryButtonText String @default("Reserva tu Experiencia")
  secondaryButtonLink String @default("/reservar")
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  @@map("hero_config")
}

// Configuraci√≥n de la p√°gina "Sobre M√≠"
model AboutConfig {
  id                String   @id @default(cuid())
  
  // Hero
  heroImage         String?
  heroTitle         String   @default("Aline Vidal")
  heroSubtitle      String   @default("Especialista en Medicina Ancestral Oriental")
  
  // Contenido principal
  biography         String   @db.Text // HTML del editor rico
  secondaryImage    String?
  
    // ‚úÖ NUEVO: Filosof√≠a separada
  philosophy        String   @default("") @db.Text // HTML del editor rico
  
  // Datos destacados
  yearsExperience   Int      @default(0)
  certifications    String[] @default([])
  
  // Video (opcional)
  videoUrl          String?
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  
  @@map("about_config")
}

// Configuraci√≥n de Redes Sociales
model SocialMediaConfig {
  id          String   @id @default(cuid())
  
  instagram   String?
  facebook    String?
  tiktok      String?
  youtube     String?
  linkedin    String?
  
  // Visibilidad
  showInstagram Boolean @default(true)
  showFacebook  Boolean @default(true)
  showTiktok    Boolean @default(false)
  showYoutube   Boolean @default(false)
  showLinkedin  Boolean @default(false)
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@map("social_media_config")
}

// Secciones destacadas de la portada (gesti√≥n de im√°genes/contenido)
model HomeSection {
  id          String   @id @default(cuid())
  
  type        String   // "featured_services", "why_choose_us", "testimonials", "custom"
  title       String
  subtitle    String?
  content     String?  @db.Text
  image       String?
  
  active      Boolean  @default(true)
  order       Int      @default(0)
  
  // Configuraci√≥n espec√≠fica (JSON)
  config      Json?
  // Ejemplo para "featured_services": { serviceIds: ["id1", "id2", "id3"] }
  // Ejemplo para "why_choose_us": { points: [{ icon: "‚úì", text: "..." }] }
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@map("home_sections")
}

// ‚úÖ AGREGAR ESTE MODELO AL FINAL DEL ARCHIVO, ANTES DE LOS ENUMS

model SeoAnalytics {
  id                      String   @id @default(cuid())
  
  // Google Search Console
  googleSearchConsole     String?  // Meta tag verification code
  
  // Google Analytics 4
  googleAnalyticsId       String?  // G-XXXXXXXXXX
  
  // Meta Pixel (Facebook)
  metaPixelId             String?  // N√∫mero del pixel
  
  // Google Tag Manager
  googleTagManagerId      String?  // GTM-XXXXXXX
  
  createdAt               DateTime @default(now())
  updatedAt               DateTime @updatedAt
  
  @@map("seo_analytics")
}

model HomeServicesSection {
  id                String   @id @default(cuid())
  
  // Textos
  title             String   @default("Nuestros Servicios")
  subtitle          String?  @db.Text
  
  // Visibilidad
  active            Boolean  @default(true)
  
  // Servicios seleccionados (array de IDs en orden)
  selectedServices  String[] @default([])
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  
  @@map("home_services_section")
}

enum EventStatus {
  DRAFT       // Borrador (no visible)
  UPCOMING    // Pr√≥ximo
  ONGOING     // En curso
  FINISHED    // Finalizado
  CANCELLED   // Cancelado
}

enum BookingStatus {
  PENDING
  CONFIRMED
  CANCELLED
  COMPLETED
  NO_SHOW
}

enum TestimonialStatus {
  PENDING
  APPROVED
  REJECTED
}